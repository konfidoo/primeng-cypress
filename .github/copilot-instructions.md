# Copilot Instructions for primeng-cypress

This repository is a lightweight helper library that provides Cypress test helpers for PrimeNG components.

## Project Overview

- **Purpose**: Provides Cypress custom commands (e.g., `cy.pButton()`) for testing PrimeNG components
- **Tech Stack**: TypeScript, Angular 21, Cypress 15, PrimeNG 21
- **Package Type**: NPM library with TypeScript declarations
- **Structure**: Source code in `src/commands/`, built output in `lib/` (generated)

## Repository Structure

```
primeng-cypress/
├── src/commands/          # Source TypeScript files
│   ├── commands.ts        # Command registration logic
│   ├── cypress.d.ts       # Cypress type augmentations
│   ├── pButton.ts         # Example: pButton helper implementation
│   ├── types.ts           # Type definitions
│   └── index.ts           # Public API exports
├── cypress/               # Example Cypress tests and support files
├── lib/                   # Built output (generated by TypeScript, not in git)
├── .github/workflows/     # CI/CD workflows
└── package.json           # Package configuration
```

## Development Workflow

### Building and Testing

1. **Install dependencies**: `npm install`
2. **Build library**: `npm run build:lib` (compiles TypeScript from `src/` to `lib/`)
3. **Type check**: `npx tsc --noEmit`
4. **Run tests**: `npm test` (runs Cypress component tests headless)
5. **Open Cypress GUI**: `npx cypress open`

### Before Making Changes

- Always run type check and existing tests first to understand baseline
- The `lib/` directory is generated - never edit files there directly
- CI runs: TypeScript check → Build library → Cypress tests

## Coding Guidelines

### TypeScript Best Practices

- Use TypeScript for all implementation files
- Keep functions small and single-responsibility
- Use clear, self-descriptive names for types and options
- Use `export type` when re-exporting types (for `isolatedModules`)
- All inline code comments must be in English

### Code Style

- Follow existing Prettier configuration (see `package.json`)
- Print width: 100 characters
- Single quotes for strings
- No unnecessary comments - code should be self-documenting

### File Organization

- Implementation files go in `src/commands/`
- Type definitions in `src/commands/types.ts` or component-specific `.types.ts` files
- Export public API through `src/commands/index.ts`
- Example tests in `cypress/` directory

## Adding New PrimeNG Command Helpers

When adding a new helper (e.g., `pCheckbox`):

1. **Create implementation**: `src/commands/pCheckbox.ts`
   - Accept selector/chainable and options object
   - Keep logic pure and testable
   
2. **Add types**: Update `src/commands/types.ts`
   - Define option interfaces
   - Export with `export type` if needed

3. **Register command**: Update `src/commands/commands.ts`
   - Add parent command: `Cypress.Commands.add('pCheckbox', ...)`
   - Add chainable: `Cypress.Commands.add('pCheckbox', { prevSubject: 'element' }, ...)`

4. **Add TypeScript declarations**: Update `src/commands/cypress.d.ts`
   - Augment `Cypress.Chainable` interface
   - Add both parent and chainable signatures

5. **Export from public API**: Update `src/commands/index.ts`
   - Export helper functions for direct usage

6. **Add example test**: Create `cypress/pCheckbox.cy.ts`
   - Demonstrate both parent and chainable usage
   - Keep tests stable, no external dependencies

7. **Update documentation**: Update `README.md`
   - Add usage examples
   - Mention in command list

8. **Verify changes**:
   ```bash
   npx tsc --noEmit
   npm run build:lib
   npx cypress run --spec "cypress/pCheckbox.cy.ts"
   ```

## Testing Guidelines

- All example specs are in `cypress/` directory
- Use component testing approach (not e2e)
- Tests should be stable and not rely on external network
- Test both parent command (`cy.pCommand()`) and chainable (`.pCommand()`) forms
- Include positive and edge case tests

## Important Constraints

- **Minimal changes**: Make surgical, focused changes only
- **No unrelated fixes**: Don't fix unrelated bugs or broken tests
- **No removal**: Never delete working code unless absolutely necessary
- **Type safety**: Always maintain TypeScript type safety
- **Backward compatibility**: Don't break existing API without good reason

## Common Tasks

### Updating Dependencies
- Check for security vulnerabilities before adding dependencies
- Prefer using existing libraries in the ecosystem
- Update `package.json` and run `npm install`

### Documentation Updates
- Update `README.md` for user-facing changes
- Update `CONTRIBUTING.md` for contributor workflow changes
- Keep examples up-to-date with actual code

### Troubleshooting Build Issues
- Check TypeScript errors: `npx tsc --noEmit`
- Verify lib build: `npm run build:lib` and check `lib/` directory
- Clear node_modules if dependency issues: `rm -rf node_modules && npm install`

## Git and PR Guidelines

- Keep commits focused on single logical changes
- Write clear commit messages
- Open PR against `main` branch
- Include description of changes and testing approach
- CI must pass: type check, build, and Cypress tests

## Package Publishing (if applicable)

- Built files are in `lib/` directory (included in npm package)
- `prepare` script runs `build:lib` before publish
- Package exports: `main: lib/index.js`, `types: lib/index.d.ts`
- For local development: Use `npm link` for iteration

## Questions or Issues?

- Review existing code patterns in `src/commands/pButton.ts` for reference
- Check `CONTRIBUTING.md` for detailed contribution guide
- See `README.md` for usage examples and troubleshooting
- Open an issue with `help wanted` tag for questions
